---
title: "Evaluating length-weight of pallid sturgeon."
author: Michael E. Colvin
date: 4 October 2016
output:
  md_document:
    variant: markdown_github
  html_document:
    theme: flatly
    highlight: espresso
    toc: FALSE
---



```{r,echo=FALSE}
## Analysis preliminaries
library(pander)
#setwd(file.path(Sys.getenv("USERPROFILE"),"My Documents/projects/pallid sturgeon/analysis/skinny-fish"))
source("./R/1_global.R")
source("./R/2_functions.R")
#source("./R/3_load.R")
#source("./R/4_clean.R")
dat<-readRDS("dat.RDS")
source("./R/5_figures.R")
source("./R/6_tables.R")
lw<- subset(dat$Kn,segment_id%in%c(1:14))
lw$jdaysq<- lw$jday*lw$jday
fit<- lm(lwgh~llen+
	jday +
	jday:basin +
	jdaysq +
	jdaysq:basin +	
	year_f + 
	basin+
	year_f:basin+
	llen:year_f + 
	basin:llen+	
	basin:llen:year_f,
	lw)

```
## Analysis source

Analysis source code can be viewed at [https://github.com/mcolvin/PDSG-LW](https://github.com/mcolvin/PDSG-LW).



## Length weight analysis of covariance

### Analysis overview:

This analysis fits length-weight data for pallid sturgeon captured in the upper (RPMA 2 and 3) and lower (RPMA 4) basins of
the Missouri River.  The rationale for this analysis is that condition is an index of weight given an expected weight and therefore
modelling expected weight as a function of length using the base model $log(Weight) = log(a)+b\cdot log(Length)$ will illustrate
changes in expected weight.  This approach allows evaluating how expected weight is changing over time that complements analyses of
condition. Specifically, if conditions is decreasing over time, it is reasonable to expect to see a decrease in expected fish weight
for a given length. 

### Methods in a nutshell

1. Fit length-weight data as a linear model by log transforming length and weight
2. Estimate effect of year, basin and specific interactions
3. An effect of day of year ($DOY$) and $DOY^2$ is included to account for within year differences in expected weight for a given length.  
3. NOTE-year is treated as a factor rather than continuous

### Preliminary results

1. Length-weight relationships varied among year and basin (Figure 1). 
1. The maximum length of Upper basin fish (RPMA 2, RPMA3) was larger than lower basin (RPMA 4) fish (Figure 1, Table 1). 
1. The model estimates a unique length-weight for each year basin combination on log log scale (Figure 2).
1. The model estimated an effect of $DOY$ and $DOY^2$ (Table 2) indicating some variability in expected weight for a given length
within year to account for seasonality.
1. The model fit was good, it should be. $R^2$ = `r summary(fit)$r.squared`
1. The length-weight Upper basin and lower basin fish varied among years, in some years upper basin fish were heavier for a given length
than lower basin fish, in other years lower basin fish were slightly heavier for a given length, and in other years they were similar (Figure 2).
1. One thing to keep in mind is that fish greater than 1200 mm were only observed in the upper basin.
1. The preliminary analysis suggests that expected weight for a given length has decreased since 2012 for RPMA4 fish.
1. Mean weight for a given length was lowest for RPMA4 fish in 2015 relative to estimates from 2003 to 2016
1. Upper expected weight for upper basin fish has remained constant since 2012.



### Discussion points

1. The effect of DOY was fixed among years but allowed to vary by basin. Might make sense to allow to vary among year as well? 
2. The effect of DOY is not quite what I want, it might make more sense to use it to model variability in the $b$ parameter in a
hierarchical fashion. 
3. Any thoughts on what happened in the upper basin in 2011 and in early years  (2003, 2004)?  Those fish might have been skinny. Floods?   


### Figures

```{r,echo=FALSE}
figures(1)
```

Figure 1. Pallid sturgeon weight (y-axis) and length (x-axis) for 2003 to 2016 grouped by Missouri River basin (Upper; pink open circles,
lower; blue open circles).  

```{r,echo=FALSE}
figures(2)# plot of mean weight at length for RPMA 2 and 4
```  

Figure 2. Plot of weight (y-axis) and length (x-axis) on log scale for Pallid Sturgeon captured in Missouri River
basins ((Upper; pink open circles, lower; blue open circles). 
Lines represent best fit linear models predicting weight from length for data in each panel and group.


```{r,echo=FALSE}
figures(3)# plot of Kn given mean weight at length for RPMA 2 and 4
```  

Figure 3. Plot of condition (y-axis) and day of year (x-axis) for Pallid Sturgeon captured in the upper and lower basins.

```{r,echo=FALSE}
figures(4)# plot of Kn given mean weight at length for RPMA 2 and 4
```  

Figure 4. Plot of estimated weight (y-axis) and year (x-axis) for varying pallid sturgeon lengths (800, 1000, 1200, and 1400 mm).
Lower basin estimates were not included for fish 1400 mm because they were not observed.
Expected weights and confidence intervals were estimated for April 1 ($DOY$ = 92).
Vertical lines denote 95% confidence intervals   .


### Tables

Table 1. Summary of length and weight by basin and year for pallid sturgeon captured in the Missouri River.  

```{r,echo=FALSE}
pander(tables(1))
```


Table 1. Parameter estimates for linear model relating weight to length.
Factors included in the the model are Julian day, Julian day squared, basin, and year.
Varying interactions were used to all the length-weight relationship to vary by year and basin.

```{r,echo=FALSE}
panderOptions("digits", 3)
pander(as.data.frame(summary(fit)$coefficients))
```

